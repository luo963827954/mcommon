!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("sortablejs")):"function"==typeof define&&define.amd?define(["sortablejs"],t):e.mcommon=t(null)}(this,function(e){"use strict";function t(e,t){var n=t.column,r=t.row,o=void 0===r?{}:r,i=t.$index,l=null,a=this.scopedSlots||this.$scopedSlots,u=this.slots&&this.slots();return a&&n.prop&&a[n.prop]?l=a[n.prop]({row:o,column:n,$index:i}):u&&n.prop&&u[n.prop]&&(l=u[n.prop]),l||e("MItem",{props:{row:o,column:n,$index:i}})}e=e&&e.hasOwnProperty("default")?e.default:e;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(e,n){var r={span:24},i=this.props,l=i.noWrap,a=i.model,u=i.formData,s=i.labelWidth;return l&&(r={}),e("el-col",{props:o({span:11,xs:r},n),key:n.prop},[e("el-form-item",{props:o({},n,{labelWidth:n.label||n.labelWidth?n.labelWidth||s:"10px"})},[t.call(this,e,{column:n,row:a||u})])])},l={functional:!0,name:"MForm",props:{formData:Object,columns:Array,model:Object,elRow:Object,noWrap:Boolean},render:function(e,t){return t.props.formData&&(t.data.attrs.model=t.props.formData),t.data.attrs.labelWidth||(t.data.attrs.labelWidth="100px"),e("el-form",t.data,[function(e){var t=this,n=this.props,r=n.columns,o=void 0===r?[]:r,l=n.elRow;return e("el-row",{props:l},o.map(function(n){return i.call(t,e,n)}))}.call(t,e)])}},a=function(e){return Object.prototype.toString.call(e).slice(8,-1)},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"¥",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";var r=Math.abs(e).toFixed(n),o=n?r.slice(0,-1-n):r,i=o.length%3,l=i>0?o.slice(0,i)+(o.length>3?",":""):"",a=n?r.slice(-1-n):"";return t+(e<0?" -":" ")+l+o.slice(i).replace(/(\d{3})(?=\d)/g,"$1,")+a},s=["maxlength","minlenght","rows","autocomplete","name","readonly","max","min","step","autofocus","form"],c={name:"MItem",props:{row:{type:Object,required:!0},column:{type:Object,required:!0},$index:Number},data:function(){return{isForce:!1}},watch:{row:function(e,t){this.$parent.clearValidate&&e!==t&&this.$nextTick(this.$parent.clearValidate)}},computed:{computedColumn:function(){return o({},this.column,this.column.getColumn&&this.column.getColumn(this.row)||{})},componentType:function(){var e=this.computedColumn.el;return e?"mSelect"===e||"MSelect"===e||"select"===e||"el-select"===e?"m-select":e.startsWith("el-")?e:"el-"+e:null},valueKey:function(){return this.computedColumn.valueKey?this.computedColumn.valueKey:{label:"label",value:"value"}},modelComputed:{get:function(){var e=null;try{e=this.getStrFunction("this.row."+this.column.prop)}catch(e){this.setRowKey(null)}return"currency"===this.column.type?this.isForce?e:u(e,this.column.currency,this.column.decimals):e},set:function(e){var t=this.computedColumn,n=t.type,r=t.trim,o=t.nullString,i=void 0===o||o;if("currency"===n||"number"===n){/^-?[0-9]*\.?\d*$/g.test(e)||(e=e.substr(0,e.length-1))}"el-input"===this.componentType&&(r&&(e=e.trim()),i&&""===e&&(e=null));try{void 0===this.getStrFunction("this.row."+this.computedColumn.prop)?this.setRowKey(e):this.getStrFunction("this.row."+this.computedColumn.prop+" = value")}catch(t){this.setRowKey(e)}}}},methods:{getStrFunction:function(e){return e=e.replace(/(\.\d)/g,"[$1]").replace(/\.\[/g,"["),new Function("return "+e).call(this)},setRowKey:function(e){if(this.computedColumn.prop&&this.row){var t=this.computedColumn.prop.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),n=t.shift(),r=t.length-1;if(r>=0){var o=this.row[n]||{},i=t.reduce(function(t,n,i){return i===r?(t[n]=e,o):(t[n]||(t[n]={}),t[n])},o);this.$set(this.row,n,JSON.parse(JSON.stringify(i)))}else this.$set(this.row,n,e)}},getParams:function(){var e={};if(this.computedColumn.params&&"object"===n(this.computedColumn.params))for(var t in this.computedColumn.params){var r=void 0;try{r=this.getStrFunction("this.row."+this.computedColumn.params[t])}catch(e){}e[t]=void 0!==r?r:this.computedColumn.params[t]}return e}},render:function(e){var t=this,n=this.row,r=(this.column,this.$index),i=this.computedColumn,l=this.modelComputed,a=this.componentType,u=this.valueKey,c=this.getParams;if(a){var p=void 0!==i.placeholder?i.placeholder:i.label,h=o({},i.listeners||{},{input:function(e){t.modelComputed=e,i.listeners&&i.listeners.input&&i.listeners.input(e)}});i.listeners&&i.listeners.currentObj&&(h.currentObj=function(e){return i.listeners.currentObj(e,n,r)});if(["m-select","el-checkbox-group","el-radio-group"].includes(a)){var d="";"button"===i.type&&(d="-button");var m="m-select"!==a?function(e,t,n,r){return(n.dataList||n.list||[]).map(function(i){var l=void 0;return l=n.slots&&n.slots.default?[n.slots.default.call(null,e,i)]:i[r.label],e(t,{props:o({},n,{label:n.props?i[n.props.value]:i[r.value]}),key:i[r.label]},l)})}(e,"el-checkbox-group"===a?"el-checkbox"+d:"el-radio"+d,i,u):null;return e(a,{props:o({},i,{placeholder:p,params:"m-select"===a?c(i):null,value:l,customRender:i.slots&&i.slots.default?i.slots.default:null}),attrs:"m-select"===a?i:null,on:h},m)}"el-input"===a&&"currency"===i.type&&(h.blur=function(){var e;t.isForce=!1,i.listeners&&i.listeners.blur&&(e=i.listeners).blur.apply(e,arguments)},h.focus=function(){var e;t.isForce=!0,i.listeners&&i.listeners.focus&&(e=i.listeners).focus.apply(e,arguments)});var f=i.slots||{},g=[],y={};Object.keys(f).forEach(function(t){"function"==typeof f[t]?y[t]=f[t].bind(null,e):g.push(e("template",{slot:t},[f[t]]))});var v=s.reduce(function(e,n){return t.computedColumn[n]&&(e[n]=t.computedColumn[n]),e},{placeholder:p});return e(a,{props:o({},i,{filterable:!0,value:l,columnOptions:i,label:"el-checkbox"===a||"el-radio"===a?null:i.label}),attrs:v,scopedSlots:y,on:h},g)}return("function"==typeof i.render?i.render(e,{row:n,computedColumn:i,$index:r}):i.render)||e("span",{class:"item-container",style:{"word-break":"break-all"}},i.format?i.format(n):l)}},p={name:"MSelect",props:{params:{type:Object,default:function(){return{}}},valueKey:{type:Object,default:function(){return{label:"label",value:"value"}}},nullRequest:Boolean,value:{type:[String,Boolean,Number,Array],default:""},dataList:Array,multiple:Boolean,showMsg:Boolean,getList:Function,remote:Boolean,customRender:Function,notClear:Boolean},data:function(){return{list:[],currentValue:"",loading:!1,selectObj:{}}},watch:{params:function(e,t){(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t!==n&&(a(t)!==a(n)||null===t||null===n||("Array"===a(t)?t.length!==n.length||t.some(function(t,o){return e(t,n[o],r)}):"Object"===a(t)?r?t[r]!==n[r]:Object.keys(t).some(function(o){return e(t[o],n[o],r)}):"Date"!==a(t)||t.getTime()!==n.getTime()))})(e,t)&&this.pageInit()},value:function(e){this.setCurrentValue()},currentValue:function(e){this.$emit("input",e),this.getCurrentObj()},dataList:function(e){this.list=e},list:function(e){var t=this;this.changeCurrentValue();var n=e.filter(function(e){return e.checked});!n.length||this.currentValue||Array.isArray(this.currentValue)&&this.currentValue.length||(this.multiple?this.currentValue=n.map(function(e){return e[t.valueKey.value]}):this.currentValue=n[0][this.valueKey.value])}},created:function(){this.setCurrentValue(),this.dataList?(this.list=this.dataList,this.currentValue&&this.getCurrentObj()):this.pageInit()},methods:{setCurrentValue:function(){this.multiple?Array.isArray(this.value)?this.currentValue=this.value:"string"==typeof this.value&&this.value?this.currentValue=this.value.split(","):this.currentValue=[]:this.currentValue=this.value},changeCurrentValue:function(){var e=this;this.notClear||(this.list.length?this.multiple?this.currentValue&&this.currentValue.length&&(this.currentValue=this.currentValue.filter(function(t){return e.list.some(function(n){return n[e.valueKey.value]===t})})):null!==this.currentValue&&void 0!==this.currentValue&&""!==this.currentValue&&!this.list.some(function(t){return t[e.valueKey.value]===e.currentValue})&&(this.currentValue=null):this.multiple?this.currentValue=[]:this.currentValue="")},pageInit:function(){var e=this,t=Object.keys(this.params);if(t.length&&(t.some(function(t){return null===e.params[t]})&&!this.nullRequest))return;this.getData()},getCurrentObj:function(){var e=this;if(this.list.length){var t=null,n=this.valueKey.value;this.multiple?(t=[],this.currentValue.forEach(function(r){var o=e.list.find(function(e){return e[n]===r});o&&t.push(o)})):t=this.currentValue&&this.list.find(function(t){return t[n]===e.currentValue})||{},this.selectObj=t,this.$emit("currentObj",t)}},remoteMethod:function(e){this.getData({keyWord:e})},getData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.getList&&(this.loading=!0,this.getList(o({},this.params,t),this.showMsg).then(function(t){var n=Array.isArray(t)?t:t.data||[];e.list=n,e.$emit("selectList",e.list),e.loading=!1}).catch(function(t){return e.list=[],e.loading=!1,Promise.reject(t)}))}},render:function(e){var t=this,n=this.list,r=this.valueKey,i=this.multiple,l=this.loading,a=this.currentValue,u=this.remoteMethod,s=this.$attrs,c=this.$listeners,p=this.customRender,h=this.remote,d=o({},c,{input:function(e){t.currentValue=e,c.input&&c.input(e)}});this.remote&&!d.clear&&(d.clear=u);var m=o({},s);return delete m.valueKey,e("el-select",{props:o({loading:l,value:a,loadingText:"加载中",filterable:!0,clearable:!0,remoteMethod:h?u:void 0,multiple:i},m),style:{width:"100%"},on:d},[n.map(function(t){return e("el-option",{props:{label:t[r.label],value:t[r.value],disabled:t.disabled},key:t[r.value]},[p?p(e,t):null])})])}},h=function(e){var t=navigator.userAgent;return"ie"===e?!!(t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1)&&(new RegExp("MSIE (\\d+\\.\\d+);").test(t),parseFloat(RegExp.$1)):t.indexOf(e)>-1},d=function(e,t,n){var r=n.separator,o=n.quoted,i=t.map(function(e){return o?'"'+(e="string"==typeof e?e.replace(/"/g,'"'):e)+'"':e});e.push(i.join(r))},m={separator:",",quoted:!1},f={_isIE11:function(){var e=0,t=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),r=navigator.userAgent.indexOf("rv:11.0");return t&&(e=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(e=10),n&&-1!==r&&(e=11),11===e},_isEdge:function(){return/Edge/.test(navigator.userAgent)},_getDownloadUrl:function(e){if(window.Blob&&window.URL&&window.URL.createObjectURL){var t=new window.Blob(["\ufeff"+e],{type:"text/csv"});return URL.createObjectURL(t)}return"data:attachment/csv;charset=utf-8,\ufeff"+encodeURIComponent(e)},download:function(e,t){if(h("ie")&&h("ie")<10){var n=window.top.open("about:blank","_blank");n.document.charset="utf-8",n.document.write(t),n.document.close(),n.document.execCommand("SaveAs",e),n.close()}else if(10===h("ie")||this._isIE11()||this._isEdge()){var r=new Blob(["\ufeff"+t],{type:"text/csv"});navigator.msSaveBlob(r,e)}else{var o=document.createElement("a");o.download=e,o.href=this._getDownloadUrl(t),document.body.appendChild(o),o.click(),document.body.removeChild(o)}},getStrFunction:function(e,t){e=e.replace(/(\.\d)/g,"[$1]").replace(/\.\[/g,"[");var n=Function;try{return new n("return this."+e).call(t)}catch(e){return}},format:function(e,t,n){var r=this;n=Object.assign({},m,n);var o=[],i=e.map(function(e){return e.label});return d(o,i,n),t.forEach(function(t){Array.isArray(t)||(t=e.map(function(e){var n=void 0;return("\t"+(n=void 0!==(n="function"==typeof e.format?e.format(t):r.getStrFunction(e.prop,t))?n:"")).replace(/,/g,"，")})),d(o,t,n)}),o.join("\r\n")}},g=function(e){var n=this,r=this.list,i=this.stripe,l=this.border,a=this.summaryMethod,u=this.summaryDefault,s=this.isShowSummary,c=this.$listeners,p=this.$attrs,h=this.expand,d=this.selection,m=this.selectable,f=this.showNum,g=this.reserveSelection,y=this.numTitle,v=this.numFiexd,b=this.numWidth,w=this.page,S=this.columns,x=this.buttonWidth,C=this.buttonAlign,O=this.buttonFixed,$=this.buttonLabel,V=this.mergeRow,j=this.mergeColumn,M=this.arraySpanMethod,F=this.spanMethod,N=[];if(h&&N.push(e("el-table-column",{props:{type:"expand"},key:"expand",scopedSlots:{default:this.$scopedSlots.expand?function(e){return n.$scopedSlots.expand(e)}:null}})),d&&r.length&&N.push(e("el-table-column",{props:{type:"selection",selectable:m,reserveSelection:g},key:"selection"})),f&&r.length){var R=function(e){return e.$index+1+(w.pageNum-1)*w.pageSize};N.push(e("el-table-column",{props:{label:y,align:"center",width:b||60,reserveSelection:g,fixed:v||S[0]&&S[0].fixed},key:"showNum",scopedSlots:{default:this.$scopedSlots.num?function(e){return n.$scopedSlots.mnum(o({},e,{num:R(e)}))}:function(e){return R(e)}}}))}this.$scopedSlots.button&&N.push(e("el-table-column",{props:{width:x,align:C||"center",fixed:O,label:$},key:"button",scopedSlots:{default:function(e){return n.$scopedSlots.button(e)}}}));var A=o({},c);return A.selectionChange&&(A["selection-change"]=A.selectionChange),e("el-table",{props:o({data:r,border:l,stripe:i,summaryMethod:a||u,showSummary:s,spanMethod:V.length||j.length?M:F},p),ref:"commontable",on:A},[].concat(N,this.$slots.default||[],function e(n,r){var i=this,l=this.filtetag,a=this.getKey;return r.map(function(r){var u=r.children||[];return n("el-table-column",{props:o({},r,{className:r.className||r.el,align:r.align||"center",filterMethod:r.filters?l.bind(null,r):null}),key:a(r.prop),scopedSlots:{default:function(e){return t.call(i,n,{column:i.getColumns(r,e),row:e.row,$index:e.$index})}}},e.call(i,n,u))})}.call(this,e,S)))},y={name:"MTable",props:{tableData:{type:Array,default:function(){return[]}},buttonWidth:[String,Number],numWidth:[String,Number],buttonAlign:{type:String,default:"center"},pageOptions:Object,buttonFixed:{type:String,default:"right"},buttonLabel:{type:String,default:"操作"},reserveSelection:Boolean,layout:{type:String,default:"total,sizes,prev, pager, next, jumper"},showNum:{type:Boolean,default:!0},hideOnSinglePage:{type:Boolean,default:!0},selectable:{type:Function},numFiexd:Boolean,showPage:{type:Boolean,default:!0},forced:Boolean,showsummary:{type:Boolean,default:!1},summaryMethod:{type:Function},border:{type:Boolean,default:!0},stripe:{type:Boolean,default:!1},numTitle:{type:String,default:"序号"},total:Number,selection:{type:Boolean,default:!1},expand:Boolean,columns:{type:Array,default:function(){return[]}},page:{type:Object,default:function(){return{pageNum:1,pageSize:15,total:0}}},pageSizes:{type:Array,default:function(){return[15,30,45,60]}},mergeRow:{type:Array,default:function(){return[]}},mergeColumn:{type:Array,default:function(){return[]}},spanMethod:Function,sumText:{type:String,default:"合计"},pageAlign:{type:String,default:"right"},drop:Boolean},inheritAttrs:!1,computed:{cTotal:function(){var e=this.total||this.page.total;return e||this.tableData.length},list:function(){var e=this,t=this.total||this.page.total;return!this.showPage||t?this.tableData:this.tableData.filter(function(t,n){return n>=(e.page.pageNum-1)*e.page.pageSize&&n<e.page.pageNum*e.page.pageSize})},summaryProps:function(){return this.columns.filter(function(e){return e.isSummary}).map(function(e){return e.prop})},isShowSummary:function(){return this.columns.some(function(e){return e.isSummary})},mergeRowData:function(){var e=this;return this.mergeRow.length?this.mergeRow.reduce(function(t,n){var o=void 0;return t[n]=e.list.reduce(function(t,i,l){var a=r({row:1},n,e.getPropValue(i,n));return 0!==l&&e.getPropValue(i,n)===t[l-1][n]?(a.row=0,t[o].row+=1):o=l,t.push(a),t},[]),t},{}):{}}},watch:{tableData:function(){var e=this.total||this.page.total;!e&&isNaN(e)&&(this.page.pageNum=1)}},methods:{toggleRowExpansion:function(){var e;(e=this.$refs.commontable).toggleRowExpansion.apply(e,arguments)},exportCsv:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.filename?-1===e.filename.indexOf(".csv")&&(e.filename+=".csv"):e.filename="table.csv";var t=[],n=[];e.columns&&e.data?(t=e.columns,n=e.data):(t=this.columns,"original"in e||(e.original=!0),n=e.original?this.tableData:this.list);var r=f.format(t,n,e);e.callback?e.callback(r):f.download(e.filename,r)},getKey:function(e){return this.forced?(e||"")+Math.random()*Date.now():e},getColumns:function(e,t){var n=null;return e.listeners&&(n=Object.keys(e.listeners).reduce(function(n,i){return o({},n,r({},i,e.listeners[i].bind(null,t)))},{})),o({},e,{disabled:e.disabled||t.row.disabled,readonly:e.readonly||t.row.readonly,listeners:n})},summaryDefault:function(e){var t=this,n=e.columns,r=e.data,o=[];return n.forEach(function(e,n){if(0!==n){if(!(t.summaryProps.indexOf(e.property)<0)){var i=r.map(function(t){return Number(t[e.property])});i.every(function(e){return isNaN(e)})||(o[n]=i.reduce(function(e,t){var n=Number(t);return isNaN(n)?e:e+t},0)),o[n]=parseFloat(o[n]||0).toFixed(2);var l=e.property,a=l?t.columns.find(function(e){return e.prop===l}):null;a&&o[n]&&(a.isCurrency?o[n]=(o[n]+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,"):"currency"===a.type&&(o[n]=u(o[n],a.currency,a.decimals)),a.unit&&(o[n]=o[n]+a.unit))}}else o[n]=t.sumText}),o},handleSizeChange:function(e){this.page.pageSize=e,this.$emit("pageChange",this.page)},handleCurrentChange:function(e){this.page.pageNum=e,this.$emit("pageChange",this.page)},toggleRowSelection:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];this.$nextTick(function(){t.forEach(function(t){e.$refs.commontable.toggleRowSelection(t,n)})})},clearSelection:function(){this.$refs.commontable.clearSelection()},getPropValue:function(e,t){t=t.replace(/(\.\d)/g,"[$1]").replace(/\.\[/g,"[");var n=Function;try{return new n("return this."+t).call(e)}catch(e){return null}},filtetag:function(e,t,n){return"function"==typeof e.filterMethod?e.filterMethod(e,t,n):this.getPropValue(n,e.prop)===t},arraySpanMethod:function(e){var t=this,n=e.row,r=e.column,o=e.rowIndex,i=r.property?this.mergeRowData[r.property]:null,l=1,a=1;if(i&&(l=i[o].row),this.mergeColumn.length)if(this.mergeColumn.indexOf(r.property)>-1){var u=this.columns.map(function(e){return e.prop}),s=u.indexOf(r.property),c=!0;a=u.reduce(function(e,r,o){return o>s&&c&&(void 0===t.getPropValue(n,r)?e+=1:c=!1),e},1)}else r.property&&void 0===this.getPropValue(n,r.property)&&(a=0);return[l,a]},rowDrop:function(){var t=this.$el.querySelector(".el-table__body-wrapper tbody"),n=this;e.create(t,{onEnd:function(e){var t=e.newIndex,r=e.oldIndex,o=JSON.parse(JSON.stringify(n.tableData)),i=o.splice(r,1)[0];o.splice(t,0,i),n.$emit("drop-change",o)}})}},render:function(e){return e("div",null,[g.call(this,e),function(e){var t=this.showPage,n=this.pageAlign,r=this.page,i=this.pageSizes,l=this.layout,a=this.cTotal,u=this.handleSizeChange,s=this.handleCurrentChange,c=this.pageOptions,p=void 0===c?{}:c,h=this.hideOnSinglePage;return this.$scopedSlots.page?this.$scopedSlots.page():t?e("el-pagination",{props:o({currentPage:r.pageNum,pageSize:r.pageSize,pageSizes:i,layout:l,total:a,hideOnSinglePage:h},p),on:{"size-change":u,"current-change":s},style:{textAlign:n}}):null}.call(this,e)])},mounted:function(){this.drop&&this.rowDrop()}},v=function e(t){if(!e.installed){if(!t.prototype.$ELEMENT)throw new Error("请先安装element-ui");t.component(l.name,l),t.component(c.name,c),t.component(p.name,p),t.component(y.name,y),e.installed=!0}};return window&&window.Vue&&v(window.Vue),{install:v,MForm:l,MItem:c,MSelect:p,MTable:y}});
